<!doctype html>
<html lang="id">
<script>
document.addEventListener("DOMContentLoaded", function () {

  if (localStorage.getItem("isLogin") !== "true") {
    window.location.href = "login.html";
    return;
  }

  const btnLogout = document.getElementById("btnLogout");
  if (btnLogout) {
    btnLogout.addEventListener("click", function (e) {
      e.preventDefault();
      if (confirm("Yakin ingin logout?")) {
        localStorage.removeItem("isLogin");
        window.location.href = "login.html";
      }
    });
  }

});
</script>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Order Grooming - Kasir Pet Shop</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />

  <!-- ================= CSS ASLI (TIDAK DIUBAH) ================= -->
  <!-- (SEMUA STYLE KAMU TETAP, TIDAK DISENTUH) -->
  <!-- ... style panjang kamu tetap di sini ... -->
</head>

<body>
<div class="app">

  <!-- ================= SIDEBAR ================= -->
  <!-- (TIDAK DIUBAH) -->

  <section class="content">
    <!-- ================= TOPBAR ================= -->
    <!-- (TIDAK DIUBAH) -->

    <main class="page">

      <!-- ================= ANTRIAN ================= -->
      <div class="soft-card p-3 mb-3">
        <div class="section-title-row mb-2">
          <div class="fw-semibold">Antrian Grooming</div>
          <span id="infoAntrian" class="badge text-bg-light border"></span>
        </div>
        <div class="d-grid gap-2" id="listAntrian"></div>
      </div>

      <!-- ================= RIWAYAT ================= -->
      <!-- (TIDAK DIUBAH) -->

    </main>
  </section>
</div>

<!-- ================= MODAL DETAIL (ASLI) ================= -->
<!-- (TETAP ADA & TIDAK DIUBAH) -->

<!-- ================= MODAL SOP GROOMING ================= -->
<div class="modal fade" id="modalSOPGrooming" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content" style="border-radius:14px;">
      <div class="modal-header">
        <div>
          <div class="fw-semibold">SOP Grooming Kucing</div>
          <div class="text-muted small" id="sopSub">-</div>
        </div>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <ol class="list-group list-group-numbered" id="sopList"></ol>
      </div>

      <div class="modal-footer">
        <button class="btn btn-outline-secondary" data-bs-dismiss="modal">Tutup</button>
      </div>
    </div>
  </div>
</div>

<!-- ================= JS ================= -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
/* ================= DATA SOP ================= */
const sopGroomingKucing = [
  "Pemeriksaan awal kondisi kucing",
  "Menyisir bulu sebelum mandi",
  "Memandikan dengan shampoo khusus kucing",
  "Membersihkan telinga",
  "Memotong kuku",
  "Pengeringan bulu",
  "Finishing & pengecekan akhir"
];

/* ================= OPEN SOP ================= */
function openSOPGrooming(trx) {
  const key = "SOP_" + trx.kode;
  const saved = JSON.parse(localStorage.getItem(key) || "[]");

  document.getElementById("sopSub").textContent =
    `${trx.kode} • ${trx.pelanggan} (${trx.hewan})`;

  const wrap = document.getElementById("sopList");
  wrap.innerHTML = "";

  sopGroomingKucing.forEach((text, i) => {
    const li = document.createElement("li");
    li.className = "list-group-item d-flex gap-2";
    li.innerHTML = `
      <input type="checkbox" class="form-check-input mt-1" ${saved.includes(i) ? "checked" : ""}>
      <span>${text}</span>
    `;

    li.querySelector("input").addEventListener("change", function () {
      let data = JSON.parse(localStorage.getItem(key) || "[]");
      if (this.checked) {
        if (!data.includes(i)) data.push(i);
      } else {
        data = data.filter(x => x !== i);
      }
      localStorage.setItem(key, JSON.stringify(data));
    });

    wrap.appendChild(li);
  });

  bootstrap.Modal.getOrCreateInstance(
    document.getElementById("modalSOPGrooming")
  ).show();
}

/* ================= HOOK KE ANTRIAN (TAMBAHAN) ================= */
/* TANPA MENGUBAH renderAntrian ASLI */
const _renderAntrian = renderAntrian;
renderAntrian = function (keyword) {
  _renderAntrian(keyword);

  document.querySelectorAll(".queue-row").forEach(row => {
    row.addEventListener("click", function (e) {
      if (e.target.closest("button,select")) return;

      const kode = this.querySelector(".queue-sub").innerText.split(" • ")[0];
      const trx = groomingTrx.find(x => x.kode === kode);
      if (trx && trx.hewan.toLowerCase().includes("kucing")) {
        openSOPGrooming(trx);
      }
    });
  });
};
</script>

</body>
</html>
